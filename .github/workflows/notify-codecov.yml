name: Notify Codecov

on:
  workflow_run:
    workflows:
      - "Contrib tests with LLMs"
      - "Contrib tests without LLMs"
      - "Core tests with LLMs"
      - "Core tests without LLMs"
      - "Integration tests"
      - "Test with optional dependencies"
    types:
      - completed

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}-${{ github.head_ref }}
  cancel-in-progress: true
permissions: {}

jobs:
  notify:
    runs-on: ubuntu-latest
    # if: github.event.workflow_run.conclusion == 'success'
    steps:
      - uses: ahmadnassri/action-workflow-run-wait@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          timeout: 900000 # 15 minutes
          delay: 60000 # 1 minute
      - name: Send Codecov notification
        uses: codecov/codecov-action@v5
        with:
          run_command: send-notifications
          token: ${{ secrets.CODECOV_TOKEN }}
          fail_ci_if_error: false
